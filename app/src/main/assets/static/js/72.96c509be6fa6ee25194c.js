webpackJsonp([72],{S2OQ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("bOdI"),i=a.n(s),n=(a("MY4N"),a("0zAV")),o=a("d4/4"),r=a("w2+g"),d=a("cU4i"),c=a("Wl27"),l=a("B1Az"),m=a("cKc3"),u=a("Au9i"),p={data:function(){return{topbar:{isShow:!0,title:"订单确认",callBack:this.goBack},params:{saveEditAddressInfo:!1,changeLocalMyinfo:!1,hasAddressInfo:!1,Address:{}},operatorName:"",detialAddress:"",placetag:"请选择地区",provinceId:"",cityId:"",districtId:"",goodsInfo:{name:"",price:"",mainImage:""},number:1,payWay:1,agreementType:!1,payments:this.paymentCallBack,payType:"",payBack:"",timer:null,payIsClick:!0,payIsOrder:!0,totalPrice:0,valueAddedName:window.sessionStorage.getItem("valueAddedName")||"",valueAddedServicesName:window.sessionStorage.getItem("valueAddedServicesName")||"",hasAddr:!1,defaultAddrValue:""}},components:i()({BaseTopbar:o.a,Cell:l.a,MessageBox:u.MessageBox,Toast:u.Toast,AddressSelection:r.a,Payment:c.a,AddressPopup:d.a},n.a.name,n.a),created:function(){this.$route.params.goodsInfo&&(this.goodsInfo=this.$route.params.goodsInfo,this.totalPrice=(Number(this.goodsInfo.price)*this.number).toFixed(2))},mounted:function(){var e=this;this.$eventHub.$on("nativeBack",function(t){e.goBack(),$Hybrid.routerList.pop(),e.$router.go(-1)})},destroyed:function(){this.$eventHub.$off("nativeBack")},computed:{mealMoney:function(){return window.sessionStorage.getItem("mealMoney")?parseInt(window.sessionStorage.getItem("mealMoney")):0}},methods:{goBack:function(){return window.sessionStorage.removeItem("valueAddedName"),window.sessionStorage.removeItem("mealMoney"),sessionStorage.removeItem("kitgoodsInfo"),!0},paymentCallBack:function(e,t){this.payType=e,this.payBack=3==e?t:"",console.log("支付方式: ",e,t)},reduceNumber:function(){1!=this.number&&(this.number--,this.totalPrice=(Number(this.goodsInfo.price)*this.number).toFixed(2))},addNumber:function(){this.number++,this.totalPrice=(Number(this.goodsInfo.price)*this.number).toFixed(2)},handleAddrCell:function(){this.hasAddr=!0},handleOverlay:function(){this.hasAddr=!1},handleAddrConfirm:function(e){this.placetag=e[0].name+"-"+e[1].name+"-"+e[2].name,this.provinceId=e[0].code,this.cityId=e[1].code,this.districtId=e[2].code,this.hasAddr=!1},checkoperatorName:function(){this.operatorName=this.operatorName.replace(/[^A-Za-z0-9_\u4e00-\u9fa5]/g,"")},agreement:function(){1==this.agreementType?this.agreementType=!1:this.agreementType=!0},canSubmit:function(){return""!=this.operatorName&&"请选择地区"!=this.placetag&&""!=this.detialAddress||(Object(u.Toast)({message:"请补全信息",position:"bottom"}),!1)},goPay:function(e){var t=this;if(this.canSubmit()){if(0==this.payIsOrder)return!1;this.payIsOrder=!1;var a={operatorName:this.operatorName,provinceId:this.provinceId,cityId:this.cityId,districtId:this.districtId,address:this.detialAddress,kitchenDetailsId:window.sessionStorage.getItem("KitchenID"),valueAddedName:this.valueAddedName,valueAddedServicesName:this.valueAddedServicesName,number:this.number,shipping:"5-10天上门安装服务"};console.log("提交数据",a),m.a.post({url:"order/kitchen/addKitchen",data:{params:a}}).then(function(a){if("生成订单"==e)return t.$router.push({name:"OrderKitchen"}),!1;if(console.log("res",a),3==t.payType){if(0==t.payIsClick)return!1;t.payIsClick=!1;t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){t.timer=null,m.a.post({url:"order/payment/start/payment",data:{params:{payType:t.payType-1,orderNumber:a.data,amount:t.goodsInfo.price*t.number+t.mealMoney,bankCardNo:t.payBack.cardNo}}}).then(function(e){t.payIsClick=!0,t.payIsOrder=!0,t.$router.push({name:"BackPay",params:{BackPayData:e,Url:"OrderKitchen"}})})},500)}})}}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"AccreditationRequirementSub"},[a("BaseTopbar",{attrs:{topbar:e.topbar}}),e._v(" "),a("Cell",{staticClass:"item",attrs:{title:"经营者姓名",isShow:"false","is-link":""}},[a("van-field",{staticClass:"user-name lineHeight-normal",attrs:{"input-align":"right",clearable:"",maxlength:"20",placeholder:"请输入经营者姓名"},on:{input:function(t){return e.checkoperatorName()}},model:{value:e.operatorName,callback:function(t){e.operatorName=t},expression:"operatorName"}})],1),e._v(" "),a("Cell",{staticClass:"item",attrs:{title:"经营场所(地址)",emit:e.handleAddrCell,"is-link":""}},[a("span",{staticClass:"pacle"},[e._v(e._s(e.placetag))])]),e._v(" "),a("div",{staticClass:"describeBox"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.detialAddress,expression:"detialAddress"}],staticClass:"describe lineHeight-normal",attrs:{maxlength:"50",placeholder:"请输入详细地址（精确到楼层门牌号）"},domProps:{value:e.detialAddress},on:{input:function(t){t.target.composing||(e.detialAddress=t.target.value)}}})]),e._v(" "),a("address-popup",{attrs:{show:e.hasAddr,defaultValue:e.defaultAddrValue},on:{overlayState:e.handleOverlay,confirmData:e.handleAddrConfirm}}),e._v(" "),a("div",{staticClass:"margin margin-top"},[a("div",{staticClass:"item-box"},[e._m(0),e._v(" "),a("div",{staticClass:"item-content"},[a("img",{staticClass:"content-img",attrs:{src:e.goodsInfo.mainImage+"?x-oss-process=image/resize,w_700",alt:""}}),e._v(" "),a("div",{staticClass:"content-right"},[a("div",{staticClass:"title"},[e._v(e._s(""+e.goodsInfo.name+(e.valueAddedName&&"+"+e.valueAddedName)+(e.valueAddedServicesName&&"+"+e.valueAddedServicesName)))]),e._v(" "),a("div",{staticClass:"price"},[e._v("￥"+e._s(e.goodsInfo.price)+".00")]),e._v(" "),a("div",{staticClass:"count-box"},[a("div",{staticClass:"count-down",on:{click:function(t){return e.reduceNumber()}}},[e._v("-")]),e._v(" "),a("div",{staticClass:"count-num"},[e._v(e._s(e.number))]),e._v(" "),a("div",{staticClass:"count-add",on:{click:function(t){return e.addNumber()}}},[e._v("+")])])])])]),e._v(" "),a("div",{staticClass:"item-footer"},[a("div",{staticClass:"footer-list btn"},[e._m(1),e._v(" "),a("div",{staticClass:"btn-content"},[a("span",[e._v("支付金额  ")]),e._v(" "),a("span",{staticClass:"money"},[e._v("￥"+e._s(e.totalPrice))])])])])]),e._v(" "),a("div",{staticClass:"bottomBox"},[a("div",{staticClass:"payContent"},[a("div",{staticClass:"left"},[a("span",[e._v("总计:")]),e._v(" "),a("span",{staticClass:"red"},[e._v("￥"+e._s(e.totalPrice))])])]),e._v(" "),a("div",{staticClass:"gopay",on:{click:function(t){return e.goPay("生成订单")}}},[e._v("\n            生成订单\n        ")])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item-title"},[t("div",[t("span",{staticClass:"icon"}),this._v(" 需求单")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"btn-left"},[t("span",[this._v("配送方式：5-10天上门安装服务  ")])])}]};var h=a("VU/8")(p,v,!1,function(e){a("l53a")},"data-v-60631f14",null);t.default=h.exports},l53a:function(e,t){}});